import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.-FKaPJU3.js";import{a as E}from"./index.ngrFHoWO.js";import{$ as A}from"./jquery.CUqvW-kL.js";import"./_commonjsHelpers.CqkleIqs.js";const u=E.create({baseURL:"http://localhost:9090",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"inherit"}}),$=E.create({baseURL:"http://localhost:9090",headers:{Accept:"application/json","Content-Type":"multipart/form-data",Authorization:"inherit"}});function X(){const[r,f]=n.useState(""),[g,x]=n.useState(""),[w,b]=n.useState(""),[F,j]=n.useState(""),[N,v]=n.useState(""),[h,y]=n.useState(""),[i,C]=n.useState(""),[c,S]=n.useState(""),[p,T]=n.useState(""),[q,t]=n.useState(""),[O,k]=n.useState(!1),[U,P]=n.useState(!1),[z,d]=n.useState(!1),[M,m]=n.useState(""),R=(a,s)=>{$.get(`/api/getuserid/${a}`,{headers:{Authorization:`Bearer ${s}`}}).then(o=>{x(o.data.lastname),b(o.data.firstname),j(o.data.email),v(o.data.mobile),o.data.qrcodeurl!==null?m(o.data.qrcodeurl):m("http://localhost:9090/images/qrcode.png"),y(`http://localhost:9090/users/${o.data.userpic}`)},o=>{o.response?t(o.response.data.message):t(o.message),setTimeout(()=>{t("")},3e3)})};n.useEffect(()=>{A("#password").prop("disabled",!0),h===null&&y("http://localhost:9090/images/pix.png");let a=sessionStorage.getItem("USERID");f(a!==null?a:"");let s=sessionStorage.getItem("TOKEN");C(s!==null?s:""),R(a,s)},[r,i,h]);const D=a=>{a.preventDefault();const s=JSON.stringify({id:r,lastname:g,firstname:w,mobile:N});u.patch(`/api/updateprofile/${r}`,s,{headers:{Authorization:`Bearer ${i}`}}).then(o=>{t(o.data.message),setTimeout(()=>{t("")},3e3)},o=>{o.response?t(o.response.data.message):t(o.message),setTimeout(()=>{t("")},3e3)})},B=a=>{if(a.target.checked){d(!0),P(!0);return}else S(""),T(""),P(!1),d(!1)},I=a=>{a.preventDefault();var s=URL.createObjectURL(a.target.files[0]);A("#userpic").attr("src",s);const o=new FormData;o.append("userpic",a.target.files[0]),$.patch(`/api/uploadpicture/${r}`,o,{headers:{Authorization:`Bearer ${i}`}}).then(l=>{t(l.data.message),setTimeout(()=>{sessionStorage.setItem("USERPIC",`http://localhost:9090/users/${l.data.userpic}`),t(""),location.reload()},3e3)},l=>{l.response?t(l.response.data.message):t(l.message),setTimeout(()=>{t("")},3e3)})},L=a=>{a.target.checked?(k(!0),d(!0)):(k(!1),d(!1))},J=()=>{const a=JSON.stringify({TwoFactorEnabled:!0});u.patch(`/api/mfa/activate/${r}`,a,{headers:{Authorization:`Bearer ${i}`}}).then(s=>{t(s.data.message),setTimeout(()=>{t(""),m(s.data.qrcodeurl)},3e3)},s=>{s.response?t(s.response.data.message):t(s.message),setTimeout(()=>{t("")},3e3)})},Q=()=>{const a=JSON.stringify({TwoFactorEnabled:!1});u.patch(`/api/mfa/activate/${r}`,a,{headers:{Authorization:`Bearer ${i}`}}).then(s=>{t(s.data.message),setTimeout(()=>{m("http://localhost:9090/images/qrcode.png"),t("")},3e3)},s=>{s.response?t(s.response.data.message):t(s.message),setTimeout(()=>{t("")},3e3)})},G=()=>{if(c===""){t("Please enter new Pasword.");let s=setTimeout(()=>{t(""),clearTimeout(s)},3e3);return}if(p===""){t("Please enter new Pasword confirmation.");let s=setTimeout(()=>{t(""),clearTimeout(s)},3e3);return}if(c!==p){t("new Password does not matched.");let s=setTimeout(()=>{t(""),clearTimeout(s)},3e3);return}const a=JSON.stringify({password:c});u.patch(`/api/changepassword/${r}`,a,{headers:{Authorization:`Bearer ${i}`}}).then(s=>{t(s.data.message),setTimeout(()=>{t("")},3e3)},s=>{s.response?t(s.response.data.message):t(s.message),setTimeout(()=>{t("")},3e3)})};return e.jsx("div",{className:"container",children:e.jsxs("div",{className:"card  bg-azure border-1",children:[e.jsx("div",{className:"card-header bg-dark border-5 border-white text-white",children:e.jsx("h3",{children:"Profile"})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{encType:"multipart/form-data",autoComplete:"false",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col",children:[e.jsx("input",{className:"form-control",id:"firstname",name:"firstname",type:"text",value:w,onChange:a=>b(a.target.value),required:!0}),e.jsx("input",{className:"form-control mt-2",id:"lastname",name:"lastname",type:"text",value:g,onChange:a=>x(a.target.value),required:!0})]}),e.jsx("div",{className:"col text-right"})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col",children:e.jsx("input",{className:"form-control mt-2",id:"email",name:"email",type:"email",value:F,onChange:a=>j(a.target.value),readOnly:!0,placeholder:"email address"})}),e.jsx("div",{className:"col",children:e.jsx("img",{id:"userpic",src:h,className:"userpic",alt:""})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col",children:e.jsx("input",{className:"form-control mt-2",id:"mobileno",name:"mobileno",type:"text",value:N,onChange:a=>v(a.target.value),required:!0})}),e.jsx("div",{className:"col",children:e.jsx("input",{className:"userpicture mt-2 text-white file-input",onChange:I,type:"file"})})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"form-check mt-2",children:[e.jsx("input",{onChange:L,className:"form-check-input",type:"checkbox",value:"",id:"checkTwoFactor"}),e.jsx("label",{className:"form-check-label text-white",htmlFor:"checkTwoFactor",children:"Enable 2-Factor Authentication"})]}),O===!0?e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-5",children:e.jsx("img",{src:M,className:"qrCode2",alt:""})}),e.jsxs("div",{className:"col",children:[e.jsx("h5",{className:"mx-3 text-warning mfa-pos-1",children:"Requirements"}),e.jsxs("p",{className:"mx-3 mfa-pos-2 text-white",children:["You need to install ",e.jsx("strong",{children:"Google or Microsoft Authenticator"})," in your Mobile Phone, once installed, click Enable Button below, and ",e.jsx("strong",{children:"SCAN QR CODE"}),", next time you login, another dialog window will appear, then enter the ",e.jsx("strong",{children:"OTP CODE"})," from your Mobile Phone in order for you to login."]}),e.jsxs("div",{className:"mfa-btn",children:[e.jsx("button",{onClick:J,type:"button",className:"btn btn-primary mfa-btn-1 mx-1",children:"enable"}),e.jsx("button",{onClick:Q,type:"button",className:"btn btn-secondary mfa-btn-2",children:"disable"})]})]})]}):null]}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"form-check mt-2",children:[e.jsx("input",{onChange:B,className:"form-check-input",type:"checkbox",id:"checkChangePassword"}),e.jsx("label",{className:"form-check-label text-white",htmlFor:"checkChangePassword",children:"Change Password"})]}),U===!0?e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"form-control mt-2",type:"password",id:"newPassword",value:c,onChange:a=>S(a.target.value),placeholder:"enter new Password"}),e.jsx("input",{className:"form-control mt-1",type:"password",id:"confNewPassword",value:p,onChange:a=>T(a.target.value),placeholder:"confirm new Password"}),e.jsx("button",{onClick:G,className:"btn btn-primary mt-2",type:"button",children:"change password"})]}):null]})]}),z===!1?e.jsx("button",{onClick:D,type:"submit",className:"btn btn-info text-dark mt-2",children:"update profile"}):null]})}),e.jsx("div",{className:"card-footer text-warning",children:q})]})})}export{X as default};
